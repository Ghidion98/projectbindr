const L="**",$="\\.\\.\\/",M=/:([^\\/]+)/g,E="router-slot",g=window,m="native",S="prefix";function b(t,e){t.dispatchEvent(new CustomEvent("changestate",{detail:e}))}function u(t,e){g.dispatchEvent(new CustomEvent(t,{detail:e}))}function v(t,e,n,r){const s=Array.isArray(e)?e:[e];return s.forEach(a=>t.addEventListener(a,n,r)),()=>s.forEach(a=>t.removeEventListener(a,n,r))}function N(t){t.forEach(e=>e())}const x=[["pushState",["pushstate","changestate"]],["replaceState",["replacestate","changestate"]],["forward",["pushstate","changestate"]],["go",["pushstate","changestate"]],["back",["popstate"]]];function H(){for(const[t,e]of x)for(const n of e)F(history,t,n);window.addEventListener("popstate",t=>{if(I({url:window.location.pathname,eventName:"popstate"})){t.preventDefault(),t.stopPropagation();return}setTimeout(()=>u("changestate"),0)})}function F(t,e,n){const r=t[e];W(t,e,r),t[e]=(...s)=>{const a=s.length>2?s[2]:null;I({url:a,eventName:n})||(r.apply(t,s),u(n))}}function W(t,e,n){t[m]==null&&(t[m]={}),t[m][`${e}`]=n.bind(t)}function I(t){return!g.dispatchEvent(new CustomEvent("willchangestate",{cancelable:!0,detail:t}))}const k=document.createElement("a");function R(t={}){return d(window.location.pathname,t)}function q(t={}){return d(U(R(),O()),t)}function O(t={}){return _(".",t)}function _(t,e={}){return k.href=t,d(k.pathname,e)}function U(t,e){return t.replace(new RegExp(`^${e}`),"")}function w(){return window.location.search}function tt(){return D(w().substring(1))}function l(t){return d(t,{start:!1,end:!1})}function et(t){return d(t,{start:!0,end:!0})}function d(t,{start:e=!0,end:n=!0}={}){return t=e&&!t.startsWith("/")?`/${t}`:!e&&t.startsWith("/")?t.slice(1):t,n&&!t.endsWith("/")?`${t}/`:!n&&t.endsWith("/")?t.slice(0,t.length-1):t}function D(t){if(t.length===0)return{};const e=t.split("&").map(n=>n.split("="));return Object.assign({},...e.map(n=>({[decodeURIComponent(n[0])]:n.length>1?decodeURIComponent(n[1]):""})))}function nt(t){return Object.entries(t).map(([e,n])=>`${e}${n!=""?`=${encodeURIComponent(n)}`:""}`).join("&")}function rt(t,e=R()){return new RegExp(`^${l(t)}(/|$)`,"gm").test(l(e))}function G(t,e){const n=[],r=l(t.path.replace(M,(i,...o)=>(n.push(o[0]),"([^/]+)"))),s=t.path===L||t.path.length===0&&t.pathMatch!="full"?/^/:(()=>{switch(t.pathMatch||S){case"full":return new RegExp(`^${r}/?$`);case"suffix":return new RegExp(`^.*?${r}/?$`);case"fuzzy":return new RegExp(`^.*?${r}.*?$`);case"prefix":default:return new RegExp(`^[/]?${r}(?:/|$)`)}})(),a=e.match(s);if(a!=null){const i=n.reduce((c,p,h)=>(c[p]=a[h+1],c),{}),o=l(e.slice(0,a[0].length)),f=l(e.slice(a[0].length,e.length));return{route:t,match:a,params:i,fragments:{consumed:o,rest:f}}}return null}function C(t,e){for(const n of t){const r=G(n,e);if(r!=null)return r}return null}async function j(t,e){let n=t.component;if(n instanceof Function)try{n=n()}catch(a){if(!(a instanceof TypeError))throw a}const r=await Promise.resolve(n);let s;return r instanceof HTMLElement?s=r:s=new(r.default?r.default:r.element?r.element:r),t.setup!=null&&t.setup(s,e),s}function B(t){return"redirectTo"in t}function K(t){return"resolve"in t}function Q(t){let e=[t];for(;t.parent!=null;)t=t.parent,e.push(t);const n=e.reduce((s,a)=>({slot:a,child:s}),void 0),r=e.length;return{tree:n,depth:r}}function V(t,e){let n=t;const r=[];for(;n!=null&&n.slot.match!=null&&e>0;)r.push(n.slot.match.fragments.consumed),n=n.child,e--;return r}function y(t,e=""){const{tree:n,depth:r}=Q(t);if(!e.startsWith("/")){let s=0;e.startsWith("./")&&(e=e.slice(2));const a=e.match(new RegExp($,"g"));if(a!=null){s=a.length;const o=a.reduce((f,c)=>f+c.length,0);e=e.slice(o)}const i=V(n,r-1-s).filter(o=>o.length>0);e=`${i.join("/")}${i.length>0?"/":""}${e}`}return _(e,{end:!1})}function z(t,e){history.replaceState(history.state,"",`${y(t,e.redirectTo)}${e.preserveQuery?w():""}`)}function P(t,e){if(t==null)return!0;const{route:n,fragments:r}=t,{route:s,fragments:a}=e,i=n==s;return r.consumed!=a.consumed||!i}function Y(t){return A(t,E)}function A(t,e,n=0,r=0){const s=t.getRootNode();if(r>=n){const i=s.querySelector(e);if(i!=null&&i!=t)return i}const a=s.getRootNode();return a.host==null?null:A(a.host,e,n,++r)}function J(){const t=navigator.platform.toUpperCase().indexOf("WIN")!==-1;window.addEventListener("click",e=>{if(t&&e.ctrlKey||!t&&e.metaKey)return;const n="composedPath"in e?e.composedPath().find(s=>s instanceof HTMLAnchorElement):e.target;if(n==null||!(n instanceof HTMLAnchorElement)||!n.href.startsWith(location.origin)||n.target!==""&&n.target!=="_self"||n.dataset.routerSlot==="disabled")return;const r=n.pathname+n.search+n.hash;e.preventDefault(),history.pushState(null,"",r)})}const X=document.createElement("template");X.innerHTML="<slot></slot>",H(),J();class Z extends HTMLElement{constructor(){super(),this.listeners=[],this._routes=[],this._lockParent=!1,this._routeMatch=null,this.addEventListener("router-slot:capture-parent",e=>{e.stopPropagation(),e.detail.parent=this}),this.render=this.render.bind(this),this.attachShadow({mode:"open"}).appendChild(X.content.cloneNode(!0))}get routes(){return this._routes}set routes(e){this.clear(),this.add(e)}get parent(){return this._parent}set parent(e){this._lockParent=!0,this._setParent(e)}_setParent(e){this._parent!==e&&(this.detachListeners(),this._parent=e,this.attachListeners())}get isRoot(){return this.parent==null}get match(){return this._routeMatch}get route(){return this.match!=null?this.match.route:null}get fragments(){return this.match!=null?this.match.fragments:null}get params(){return this.match!=null?this.match.params:null}connectedCallback(){if(!this._lockParent){const e=new CustomEvent("router-slot:capture-parent",{composed:!0,bubbles:!0,detail:{parent:null}});this.parentNode?(this.parentNode.dispatchEvent(e),this._setParent(e.detail.parent??null)):this._setParent(null)}this.parent&&requestAnimationFrame(()=>{this.parent&&this.parent.match!==null&&this.match===null&&this.render()})}disconnectedCallback(){this.detachListeners()}queryParentRouterSlot(){return Y(this)}constructAbsolutePath(e){return y(this,e)}add(e,n){if(this._routes.push(...e),n===void 0&&(n=this._routeMatch===null,n===!1&&this.isConnected)){const r=this.getRouteMatch();r&&(n=P(this.match,r))}n??(n=this.isRoot&&this.isConnected),n&&this.render()}clear(){this._routes.length=0}async render(){if(!this.isConnected)return;const e=this.getPathFragment();await this.renderPath(e)}getPathFragment(){return this.parent!=null&&this.parent.fragments!=null?this.parent.fragments.rest:q()}getRouteMatch(){return C(this._routes,this.getPathFragment())}attachListeners(){this.listeners.push(this.parent!=null?v(this.parent,"changestate",this.render):v(g,"changestate",this.render))}clearChildren(){for(;this.firstChild!=null;)this.firstChild.destroy?.(),this.firstChild.parentNode.removeChild(this.firstChild)}detachListeners(){N(this.listeners)}notifyChildRouters(e){this._routeMatch!==null&&requestAnimationFrame(()=>{b(this,e)})}async renderPath(e){const n=C(this._routes,e);if(n==null)return this._routeMatch=null,!1;const{route:r}=n,s={match:n,slot:this};try{const a=P(this.match,n);if(a){this._cancelNavigation?.();let i=!1;const o=()=>{i=!0,this._cancelNavigation=void 0};this._cancelNavigation=o;const f=v(g,"changestate",o,{once:!0}),c=()=>{f()},p=()=>(c(),u("navigationcancel",s),u("navigationend",s),!1);if(u("navigationstart",s),r.guards!=null){for(const h of r.guards)if(!await h(s))return p()}if(this.notifyChildRouters(s),B(r))return c(),z(this,r),!1;if(K(r)){if(await r.resolve(s)===!1)return p()}else{const h=await j(r,s);if(i)return p();const T=this.firstChild===h;T||this.clearChildren(),this._routeMatch=n,T||h&&this.appendChild(h)}c()}else this.notifyChildRouters(s);return this._routeMatch=n,a&&(u("navigationsuccess",s),u("navigationend",s)),a}catch(a){throw u("navigationerror",s),u("navigationend",s),a}}}window.customElements.define(E,Z);export{L as CATCH_ALL_WILDCARD,S as DEFAULT_PATH_MATCH,g as GLOBAL_ROUTER_EVENTS_TARGET,m as HISTORY_PATCH_NATIVE_KEY,M as PARAM_IDENTIFIER,E as ROUTER_SLOT_TAG_NAME,Z as RouterSlot,$ as TRAVERSE_FLAG,v as addListener,F as attachCallback,O as basePath,y as constructAbsolutePath,_ as constructPathWithBasePath,u as dispatchGlobalRouterEvent,b as dispatchRouteChangeEvent,J as ensureAnchorHistory,H as ensureHistoryEvents,et as ensureSlash,V as getFragments,z as handleRedirect,x as historyPatches,rt as isPathActive,B as isRedirectRoute,K as isResolverRoute,G as matchRoute,C as matchRoutes,R as path,q as pathWithoutBasePath,tt as query,A as queryParentRoots,Y as queryParentRouterSlot,w as queryString,N as removeListeners,j as resolvePageComponent,W as saveNativeFunction,P as shouldNavigate,d as slashify,l as stripSlash,U as stripStart,D as toQuery,nt as toQueryString,Q as traverseRouterTree};
